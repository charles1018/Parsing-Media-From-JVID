# ğŸ› Docker Bug ä¿®å¾©å ±å‘Š

**ä¿®å¾©æ—¥æœŸï¼š** 2025-10-25  
**åˆ†æ”¯ï¼š** `feature/docker`  
**æäº¤è¨˜éŒ„ï¼š** `dc2e430`, `b9918b7`

---

## ğŸ“‹ å•é¡Œç¸½çµ

Docker å®¹å™¨é‹è¡Œæ™‚å‡ºç¾å…©å€‹é—œéµå•é¡Œï¼Œå°è‡´ä¸‹è¼‰åŠŸèƒ½ç„¡æ³•æ­£å¸¸å·¥ä½œï¼š

1. **è·¯å¾‘åˆ†éš”ç¬¦å•é¡Œ** - Windows è·¯å¾‘åœ¨ Linux å®¹å™¨ä¸­ç„¡æ³•ä½¿ç”¨
2. **Cookie è®€å–å¤±æ•—** - èªè­‰æ–‡ä»¶è·¯å¾‘é…ç½®ä¸ç•¶

---

## ğŸ› Bug #1: è·¯å¾‘åˆ†éš”ç¬¦éŒ¯èª¤

### éŒ¯èª¤ç¾è±¡
```bash
docker compose run --rm jvid-dl -u "..." -a
PermissionError: [Errno 13] Permission denied: '/app\media'
```

### æ ¹æœ¬åŸå› 
ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼äº† Windows è·¯å¾‘åˆ†éš”ç¬¦ `\\`ï¼š

```python
# âŒ éŒ¯èª¤å¯«æ³•
self.path = os.getcwd() + '\\' + obj.path
permissions_path = os.getcwd() + '\\package\\permissions.txt'
```

åœ¨ Linux Docker å®¹å™¨ä¸­ç”¢ç”Ÿç„¡æ•ˆè·¯å¾‘ï¼š`/app\media`

### ä¿®å¾©æ–¹æ¡ˆ

**Commit:** `dc2e430`  
**æ–‡ä»¶ï¼š** `package/ParsingMediaLogic.py`

```python
# âœ… æ­£ç¢ºå¯«æ³•ï¼ˆè·¨å¹³å°ï¼‰
self.path = os.path.join(os.getcwd(), obj.path)
permissions_path = os.path.join(os.getcwd(), 'package', 'permissions.txt')
```

### ä¿®å¾©ä½ç½®
- ç¬¬ 27 è¡Œï¼šåª’é«”è·¯å¾‘æ§‹å»º
- ç¬¬ 71 è¡Œï¼špermissions.txt è·¯å¾‘

---

## ğŸ› Bug #2: Cookie æ–‡ä»¶ç„¡æ³•è®€å–

### éŒ¯èª¤ç¾è±¡
```bash
âš ï¸  è­¦å‘Š: æœªæ‰¾åˆ° cookie æ–‡ä»¶ï¼Œå°‡ä½¿ç”¨åŸºæœ¬è«‹æ±‚é ­
åµæ¸¬åˆ° 6 å€‹åœ–ç‰‡     # æ‡‰è©²æ˜¯ 32 å€‹åœ–ç‰‡
```

### æ ¹æœ¬åŸå› 
Docker é…ç½®å’Œä»£ç¢¼æœç´¢è·¯å¾‘ä¸ä¸€è‡´ï¼š

- **Docker æ›è¼‰ä½ç½®ï¼š** `/app/cookies/www.jvid.com_cookies.json`
- **CookieManager æœç´¢ä½ç½®ï¼š** `/app/www.jvid.com_cookies.json`

### ä¿®å¾©æ–¹æ¡ˆ

**Commit:** `b9918b7`  
**æ–‡ä»¶ï¼š** `package/utils/CookieManager.py`

```python
# âœ… æ–°å¢å¤šè·¯å¾‘æœç´¢
search_paths = [
    self.base_path,              # æ ¹ç›®éŒ„ï¼ˆæœ¬åœ°é–‹ç™¼ï¼‰
    self.base_path / 'cookies'   # cookies å­ç›®éŒ„ï¼ˆDockerï¼‰
]

for search_path in search_paths:
    for filename in self.COOKIE_FILENAMES:
        cookie_path = search_path / filename
        if cookie_path.exists():
            return cookie_path
```

---

## âœ… æ¸¬è©¦çµæœ

### ä¿®å¾©å‰ vs ä¿®å¾©å¾Œ

| æ¸¬è©¦é …ç›® | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ | ç‹€æ…‹ |
|---------|--------|--------|------|
| **è·¯å¾‘è™•ç†** | `/app\media` (ç„¡æ•ˆ) | `/app/media` (æœ‰æ•ˆ) | âœ… |
| **Cookie è®€å–** | âŒ å¤±æ•— | âœ… æˆåŠŸ | âœ… |
| **èªè­‰é¡¯ç¤º** | åŸºæœ¬è«‹æ±‚é ­ | Bearer + 7 cookies | âœ… |
| **åœ–ç‰‡æ•¸é‡** | 6 å¼µï¼ˆå…è²»ï¼‰ | 32 å¼µï¼ˆå®Œæ•´ï¼‰ | âœ… |
| **ä¸‹è¼‰æ™‚é–“** | ~7 ç§’ | ~30 ç§’ | âœ… |

### å®Œæ•´æ¸¬è©¦è¼¸å‡º

```bash
# ä¿®å¾©å¾Œçš„æˆåŠŸè¼¸å‡º
============================================================
[Authentication] èªè­‰è³‡è¨Šæ‘˜è¦
============================================================
[OK] Authorization: Bearer eyJhbGciOiJIU...3a5_ShiS_A
[OK] Cookies: å·²è¼‰å…¥ 7 å€‹ cookies
============================================================

Get Parameter... ============================================== 100%
åµæ¸¬åˆ°é é¢åŒ…å«: å½±ç‰‡, åœ–ç‰‡
æœªæ‰¾åˆ°ä»»ä½• m3u8 æª”æ¡ˆ
ä½¿ç”¨ 1 å€‹åŸ·è¡Œç·’ä¸‹è¼‰åœ–ç‰‡
åµæ¸¬åˆ° 32 å€‹åœ–ç‰‡
é–‹å§‹ä¸‹è¼‰åœ–ç‰‡ï¼ŒåŸ·è¡Œç·’æ•¸: 1ï¼Œæœ€å¤§åŸ·è¡Œç·’æ•¸: 1
åœ–ç‰‡ä¸‹è¼‰é€²åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 32/32 [00:29<00:00,  1.08it/s]
åœ–ç‰‡ä¸‹è¼‰å®Œæˆï¼Œå…±ä¸‹è¼‰ 32 å¼µåœ–ç‰‡
Finish Task ! Exit Program ...
```

---

## ğŸ” æŠ€è¡“ç´°ç¯€

### ç‚ºä»€éº¼ä½¿ç”¨ `os.path.join()`ï¼Ÿ

| æ–¹æ³• | Windows | Linux | è·¨å¹³å° |
|------|---------|-------|--------|
| `path + '\\' + file` | âœ… | âŒ | âŒ |
| `path + '/' + file` | âš ï¸ | âœ… | âš ï¸ |
| `os.path.join(path, file)` | âœ… | âœ… | âœ… |

### Cookie æœç´¢ç­–ç•¥

```
æœç´¢é †åºï¼š
1. /app/www.jvid.com_cookies.json     (æœ¬åœ°é–‹ç™¼)
2. /app/jvid_cookies.json             (æœ¬åœ°é–‹ç™¼)
3. /app/cookies.json                  (æœ¬åœ°é–‹ç™¼)
4. /app/cookies/www.jvid.com_cookies.json  (Docker)
5. /app/cookies/jvid_cookies.json     (Docker)
6. /app/cookies/cookies.json          (Docker)
```

---

## ğŸ“Š å½±éŸ¿ç¯„åœ

### ä¿®å¾©å½±éŸ¿çš„åŠŸèƒ½
- âœ… Docker å®¹å™¨ä¸‹è¼‰åŠŸèƒ½
- âœ… Cookie èªè­‰æ©Ÿåˆ¶
- âœ… åª’é«”æ–‡ä»¶è·¯å¾‘è™•ç†
- âœ… æ—¥èªŒè¨˜éŒ„åŠŸèƒ½

### ä¸å½±éŸ¿çš„åŠŸèƒ½
- âœ… æœ¬åœ° uv é‹è¡Œï¼ˆå®Œå…¨å…¼å®¹ï¼‰
- âœ… Windows ç›´æ¥é‹è¡Œ
- âœ… ç¾æœ‰ API æ¥å£

---

## ğŸ¯ æœªä¾†æ”¹é€²å»ºè­°

### çŸ­æœŸï¼ˆå·²å®Œæˆï¼‰
- [x] ä¿®å¾©è·¯å¾‘åˆ†éš”ç¬¦å•é¡Œ
- [x] æ”¯æ´ Docker cookie è®€å–
- [x] æ·»åŠ æ¸¬è©¦é©—è­‰

### ä¸­æœŸï¼ˆå¯é¸ï¼‰
- [ ] æ·»åŠ ç’°å¢ƒè®Šæ•¸é…ç½® cookie è·¯å¾‘
- [ ] æ”¹é€²éŒ¯èª¤æç¤ºä¿¡æ¯
- [ ] æ·»åŠ  cookie æœ‰æ•ˆæ€§æª¢æŸ¥

### é•·æœŸï¼ˆå¯é¸ï¼‰
- [ ] æ”¯æ´å¤šç¨®èªè­‰æ–¹å¼
- [ ] è‡ªå‹• cookie æ›´æ–°æ©Ÿåˆ¶
- [ ] Web UI é…ç½®ç•Œé¢

---

## ğŸ“š ç›¸é—œæ–‡æª”

- **Docker ä½¿ç”¨æŒ‡å—ï¼š** `DOCKER.md`
- **å¿«é€Ÿé–‹å§‹æŒ‡å—ï¼š** `NEXT_CHAT_QUICK_START.md`
- **ç”¨æˆ¶æ‰‹å†Šï¼š** `USER_GUIDE.md`

---

## âœ¨ ç¸½çµ

å…©å€‹é—œéµ bug å·²å…¨éƒ¨ä¿®å¾©ï¼š
1. âœ… è·¨å¹³å°è·¯å¾‘è™•ç†
2. âœ… Docker ç’°å¢ƒ cookie è®€å–

Docker ç‰ˆæœ¬ç¾åœ¨èˆ‡æœ¬åœ°ç‰ˆæœ¬åŠŸèƒ½å®Œå…¨å°ç­‰ï¼Œå¯ä»¥æ­£å¸¸æŠ•å…¥ä½¿ç”¨ã€‚

**é©—è­‰å‘½ä»¤ï¼š**
```bash
# æ§‹å»º
docker compose build

# æ¸¬è©¦ä¸‹è¼‰
docker compose run --rm jvid-dl -u "https://www.jvid.com/v/A19370od" -a

# é æœŸçµæœï¼šä¸‹è¼‰ 32 å¼µå®Œæ•´åœ–ç‰‡
```
